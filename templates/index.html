<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI考试练习系统 - 移动端</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 10px; }
        .container { max-width: 500px; margin: 0 auto; background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); overflow: hidden; }
        .header { background: linear-gradient(45deg, #2196F3, #21CBF3); color: white; padding: 20px; text-align: center; }
        .header h1 { font-size: 1.5em; margin-bottom: 5px; }
        .header p { opacity: 0.9; font-size: 0.9em; }
        .content { padding: 20px; }
        .question-area { background: #f8f9fa; border-radius: 10px; padding: 15px; margin-bottom: 20px; border-left: 4px solid #2196F3; }
        .question-type { background: #2196F3; color: white; padding: 5px 10px; border-radius: 15px; font-size: 0.8em; display: inline-block; margin-bottom: 10px; }
        .question-no { margin-left: 10px; color: #555; font-size: 0.85em; }
        .question-text { font-size: 1.1em; line-height: 1.6; color: #333; }
        .options-area { margin-bottom: 20px; }
        .option { background: white; border: 2px solid #e9ecef; border-radius: 10px; padding: 15px; margin-bottom: 10px; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; }
        .option:hover { border-color: #2196F3; background: #f8f9ff; }
        .option.selected { border-color: #2196F3; background: #e3f2fd; }
        .option.correct { border-color: #4CAF50; background: #e8f5e8; }
        .option.incorrect { border-color: #f44336; background: #ffe8e8; }
        .option input { margin-right: 10px; transform: scale(1.2); }
        .buttons { display: flex; gap: 10px; margin-bottom: 20px; }
        .btn { flex: 1; padding: 12px; border: none; border-radius: 10px; font-size: 1em; font-weight: bold; cursor: pointer; }
        .btn-primary { background: #2196F3; color: white; }
        .btn-primary:hover { background: #1976D2; }
        .btn-success { background: #4CAF50; color: white; }
        .btn-success:hover { background: #388E3C; }
        .stats { background: #f8f9fa; border-radius: 10px; padding: 12px; margin-bottom: 12px; }
        .stats-row { display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px dashed #e0e0e0; }
        .stats-row:last-child { border-bottom: none; }
        .result { padding: 12px; border-radius: 10px; background: #fff3cd; color: #856404; margin-bottom: 12px; }
        .result.success { background: #e8f5e9; color: #2e7d32; }
        .result.error { background: #ffebee; color: #c62828; }
        .hidden { display: none; }
        .jump-area { display: flex; gap: 10px; margin-bottom: 12px; }
        .jump-area input { flex: 1; padding: 10px; border: 2px solid #e9ecef; border-radius: 10px; font-size: 1em; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎯 AI考试练习系统</h1>
            <p>移动端版 · 随时随地练习</p>
        </div>

        <div class="content">
            <!-- 开始界面 -->
            <div id="start-screen">
                <div class="result">
                    <div>
                        <h3>欢迎使用AI考试系统</h3>
                        <p>支持单选题、多选题、判断题练习</p>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="startExam()">开始考试</button>
            </div>

            <!-- 考试界面 -->
            <div id="exam-screen" class="hidden">
                <!-- 题目区域 -->
                <div class="question-area">
                    <div class="question-type" id="question-type">单选题</div>
                    <span class="question-no" id="question-no"></span>
                    <div class="question-text" id="question-text">题目内容...</div>
                </div>

                <!-- 跳题区域 -->
                <div class="jump-area">
                    <input type="number" id="jump-input" min="1" placeholder="输入要跳转的题号">
                    <button class="btn" onclick="jumpToQuestion()">跳转</button>
                </div>

                <!-- 选项区域 -->
                <div class="options-area" id="options-area"></div>

                <!-- 按钮区域 -->
                <div class="buttons">
                    <button class="btn btn-primary" id="submit-btn" onclick="submitAnswer()">提交答案</button>
                    <button class="btn btn-success" id="next-btn" onclick="nextQuestion()" disabled>下一题</button>
                </div>

                <!-- 统计信息 -->
                <div class="stats" id="stats">
                    <div class="stats-row">
                        <span>📊 进度:</span>
                        <span id="progress">已 0 题</span>
                    </div>
                    <div class="stats-row">
                        <span>✅ 正确:</span>
                        <span id="correct-count">0 题</span>
                    </div>
                    <div class="stats-row">
                        <span>📈 正确率:</span>
                        <span id="accuracy">0%</span>
                    </div>
                </div>

                <!-- 结果显示 -->
                <div class="result" id="result">请选择答案后点击提交</div>

                <!-- 重新开始按钮 -->
                <button class="btn btn-primary" onclick="restartExam()" style="width: 100%">重新开始</button>
            </div>
        </div>
    </div>

    <script>
        let currentQuestionData = null;
        let selectedAnswers = [];

        function startExam() {
            fetch('/start_exam', {method: 'POST'})
                .then(response => response.json())
                .then(data => {
                    document.getElementById('start-screen').classList.add('hidden');
                    document.getElementById('exam-screen').classList.remove('hidden');
                    nextQuestion();
                });
        }

        function nextQuestion() {
            // 重置界面状态
            document.getElementById('submit-btn').disabled = false;
            document.getElementById('next-btn').disabled = true;
            document.getElementById('result').textContent = '请选择答案后点击提交';
            document.getElementById('result').className = 'result';
            selectedAnswers = [];

            fetch('/get_question')
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        currentQuestionData = data;
                        displayQuestion(data);
                        updateStats();
                    }
                });
        }

        function displayQuestion(data) {
            // 显示题目类型
            const typeNames = {
                'single_choice': '【单选题】',
                'multiple_choice': '【多选题】',
                'judgment': '【判断题】'
            };
            document.getElementById('question-type').textContent = typeNames[data.question_type];
            const qno = document.getElementById('question-no');
            if (qno) qno.textContent = `第 ${data.question_number} 题 / 共 ${data.total_count} 题`;

            // 显示题目内容
            document.getElementById('question-text').textContent = data.question_text;

            // 生成选项
            const optionsArea = document.getElementById('options-area');
            optionsArea.innerHTML = '';

            data.options.forEach(option => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option';
                optionDiv.onclick = () => selectOption(option.value, data.question_type);

                const inputType = data.question_type === 'multiple_choice' ? 'checkbox' : 'radio';
                const inputName = data.question_type === 'multiple_choice' ? 'answer[]' : 'answer';

                optionDiv.innerHTML = `
                    <input type="${inputType}" name="${inputName}" value="${option.value}" id="option-${option.value}">
                    <label for="option-${option.value}">${option.value}. ${option.text}</label>
                `;

                optionsArea.appendChild(optionDiv);
            });
        }

        function selectOption(value, questionType) {
            const input = document.getElementById(`option-${value}`);

            if (questionType === 'multiple_choice') {
                input.checked = !input.checked;
                if (input.checked) {
                    if (!selectedAnswers.includes(value)) {
                        selectedAnswers.push(value);
                    }
                } else {
                    selectedAnswers = selectedAnswers.filter(a => a !== value);
                }
            } else {
                // 单选题和判断题
                document.querySelectorAll('input[name="answer"]').forEach(inp => inp.checked = false);
                input.checked = true;
                selectedAnswers = [value];
            }

            // 更新选项样式
            document.querySelectorAll('.option').forEach(opt => opt.classList.remove('selected'));
            document.querySelectorAll('input:checked').forEach(inp => {
                inp.closest('.option').classList.add('selected');
            });
        }

        function submitAnswer() {
            if (selectedAnswers.length === 0) {
                alert('请先选择答案');
                return;
            }

            const answer = selectedAnswers.sort().join('');

            fetch('/submit_answer', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({answer: answer})
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    showResult(data);
                    highlightOptions(data);
                    document.getElementById('submit-btn').disabled = true;
                    document.getElementById('next-btn').disabled = false;
                    updateStats(data);
                }
            });
        }

        function showResult(data) {
            const resultDiv = document.getElementById('result');
            if (data.is_correct) {
                resultDiv.textContent = `恭喜！回答正确！`;
                resultDiv.className = 'result success';
            } else {
                resultDiv.textContent = `回答错误！正确答案: ${data.correct_answer}`;
                resultDiv.className = 'result error';
            }
        }

        function highlightOptions(data) {
            const correctAnswers = data.correct_answer.split('');
            const userAnswers = data.user_answer.split('');

            document.querySelectorAll('.option').forEach(option => {
                const input = option.querySelector('input');
                const value = input.value;

                if (correctAnswers.includes(value)) {
                    option.classList.add('correct');
                } else if (userAnswers.includes(value)) {
                    option.classList.add('incorrect');
                }
            });
        }

        function updateStats(data = null) {
            if (data) {
                document.getElementById('progress').textContent = '已 ' + data.total_questions + ' 题';
                document.getElementById('correct-count').textContent = `${data.correct_answers} 题`;
                document.getElementById('accuracy').textContent = `${data.accuracy}%`;
            } else {
                fetch('/get_stats')
                    .then(response => response.json())
                    .then(statsData => {
                        document.getElementById('progress').textContent = '已 ' + statsData.total_questions + ' 题';
                        document.getElementById('correct-count').textContent = `${statsData.correct_answers} 题`;
                        document.getElementById('accuracy').textContent = `${statsData.accuracy}%`;
                    });
            }
        }

        function jumpToQuestion() {
            const input = document.getElementById('jump-input');
            const value = parseInt(input.value, 10);
            if (!value || value < 1) { alert('请输入有效的题号'); return; }
            // 重置界面状态
            document.getElementById('submit-btn').disabled = false;
            document.getElementById('next-btn').disabled = true;
            document.getElementById('result').textContent = '请选择答案后点击提交';
            document.getElementById('result').className = 'result';
            selectedAnswers = [];
            fetch('/jump_to', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ question_number: value }) })
                .then(r => r.json())
                .then(data => {
                    if (data.status === 'success') {
                        displayQuestion(data);
                        updateStats();
                    } else {
                        alert(data.message || '跳转失败');
                    }
                });
        }

        function restartExam() {
            location.reload();
        }
    </script>
</body>
</html>
